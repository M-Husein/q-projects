<!DOCTYPE html>
<html lang="en">
<head>
<base href="https://m-husein.github.io/q-projects/">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BRI Quote Demo Web Application Develop By Muhamad Husein aka Q-think">
<meta name="author" content="Muhamad Husein, Q-think">
<meta name="theme-color" content="#020f37">
<link rel="icon" href="favicon.ico">
<title>Money Changer Outlet</title>
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/fa.css">
<link rel="stylesheet" href="css/Q.css">
<style>
@media(max-width:767px){
	div.container.map-wrap{ /* .map-wrap */
		max-width:none;
	}
	.map-wrap .col-lg-9{
		height:75vh;
	}
	.map-wrap .card-body{
		display:-ms-flexbox;
		display:-webkit-flex;
		display:flex;
		flex-flow:row;
		align-items:center;
		justify-content:center;
		padding:.5rem;
	}
	.map-wrap .card-body > .btn{
		margin:0!important;
	}
	.map-wrap .card-body > div{
		margin:0 .5rem;
	}
	#dropConfirmLocation{
		justify-content:flex-start;
	}
	#dropConfirmLocation *{
		margin-top:18vh;
	}
}
.mark-layer > div:nth-of-type(2){
   background-color:blue;
   overflow:initial;
   border-radius:50%;
   -webkit-tap-highlight-color:transparent;
}
.mark-layer > div:nth-of-type(2):before{
    content:'';
    display:block;
    position:absolute;
    width:100%;
    height:100%;
    top:0;
    left:0;
    background-color:inherit;
    border-radius:inherit;
    -webkit-transition:opacity .3s,-webkit-transform .3s;
    transition:opacity .3s,-webkit-transform .3s;
    transition:opacity .3s,transform .3s;
    transition:opacity .3s,transform .3s,-webkit-transform .3s;
    -webkit-animation:pulse-animation .85s cubic-bezier(0.24,0,0.38,1) infinite;
    animation:pulse-animation .85s cubic-bezier(0.24,0,0.38,1) infinite;
    z-index:-1;
}
</style>
</head>
<body class="flx-body">

<div class="modal fade" id="modalCheckBN" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Quotation Services</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" title="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
				<div class="form-group">
					<label for="Area">Area</label>
					<select class="form-control" id="Area">
						<option selected></option>
						<option>2</option>
					</select>
				</div>
				<div class="form-group">
					<label for="Currency">Currency</label>
					<select class="form-control" id="Currency">
						<option>1</option>
						<option>2</option>
					</select>
				</div>
				<small class="form-text text-muted">* Only applied for transaction above equivalent IDR Rp. 25.000.000</small>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-warning">Check BN Availibility</button>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="modalConvertRate" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Converter rate</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" title="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
      	<!-- <div class="px-3"> -->
				  <div class="form-group form-row">
				  	<div class="col-sm-3">
					    <select class="custom-select">
					    	<option value="USD" selected>USD</option>
					    	<option value="USD">IDR</option>
					    </select>
				    </div>
				    <div class="col-sm-9">
				      <input type="text" class="form-control" id="fromCur">
				    </div>
				  </div>
				  <div class="form-row">
				  	<div class="col-sm-3">
					    <select class="custom-select">
					    	<option value="USD">USD</option>
					    	<option value="USD" selected>IDR</option>
					    </select>
					  </div>
				    <div class="col-sm-9">
				      <input type="text" class="form-control" id="toCur">
				    </div>
				  </div>
			  <!-- </div> -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-warning">Calculate</button>
      </div>
    </form>
  </div>
</div><!-- /#modalConvertRate -->

<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-bri" id="navMain">
  <div class="container">
	  <a href="BRI-Quote/index.html"><!--  class="navbar-brand" -->
	  	<img src="img/BRI_Quote_Logo.png" width="100" height="40" class="d-inline-block align-top" alt="BRI Quote">
		</a>
	  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navTop" aria-controls="navTop" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	  </button>
	  <div class="collapse navbar-collapse" id="navTop">
	    <ul class="navbar-nav">
	      <li class="nav-item"><!-- active -->
	        <a class="nav-link px-3" href="BRI-Quote/beranda.html">Beranda</a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link px-3" href="#">Pesan Masuk</a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link px-3" href="#">Bantuan</a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link px-3" href="BRI-Quote/index.html">Logout</a>
	      </li>
	    </ul>
	  </div>
	</div>
</nav>

<nav class="navbar navbar-expand-lg navbar-light bg-custom" id="navMore">
	<div class="container">
	  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav2" aria-controls="nav2" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	  </button>
	  <div class="collapse navbar-collapse justify-content-start" id="nav2">
	    <div class="navbar-nav">
	      <a class="nav-item nav-link text-dark mr-4" href="#">Information</a>
	      <a class="nav-item nav-link text-dark mr-4" href="#modalCheckBN" data-toggle="modal">Quotation Services</a>
	      <a class="nav-item nav-link text-dark mr-4" href="#modalConvertRate" data-toggle="modal">Converter rate</a>
	      <a class="nav-item nav-link text-dark mr-4" href="BRI-Quote/kurs_counter.html">Kurs Counter</a>
	      <a class="nav-item nav-link text-dark mr-4" href="BRI-Quote/money_changer_outlet.html">Money Changer Outlet</a>
	    </div>
	  </div>
	</div>
</nav>

<div class="container py-4 center-mid map-wrap">
	<div class="row w-100 flex-xs-column">
		<div class="col-lg-9 flex-1-xs"><!--  h-100 -->
			<div id="Gmap"></div>
		</div>
		<div class="col-lg-3">
			<div class="card rounded-0 text-center">
				<div class="card-body">
					<button type="button" class="btn btn-primary btn-block mb-3"><i class="fa fa-phone"></i> Call Now</button>
					<div><span class="border border-dark rounded-circle p-2">OR</span></div>
					<button type="button" class="btn btn-primary btn-block mt-3" id="btnGetDirectionAlert"><i class="fa fa-map-marker"></i> Get Direction</button>
				</div>
			</div>
		</div>
	</div>
</div>

<nav class="nav bg-bri">
	<div class="container d-flex flex-xs-column align-items-center justify-content-between py-2">
		<div>
			<a class="text-white" href="#"><small>Syarat dan Ketentuan</small></a>
			<span class="text-white px-1">|</span>
			<a class="text-white" href="#"><small>Kebijakan Privasi dan Keamanan</small></a>
		</div>
		<div class="text-white">
			<small>Copyright @ 2018 Bank Rakyat Indonesia (Persero) Tbk.</small>
		</div>
	</div>
</nav>

<script src="js/jquery-2.1.4.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/sweetalert.min.js"></script>
<script src="js/Q.js"></script>
<script>
var map,allCabang = [],cabangMark;
var markerBRI = {
  url:ORIGIN+'img/bank_bri.png'
};

function initMap(){
  map = new google.maps.Map(document.getElementById('Gmap'),{
    zoom:4,
    center:{lat:-2.0473207,lng:118.2315622} // lat:-2.44565,lng:117.8888
  });
  setMarkers(map);
}

var cabangBRI = [
	{"cabang":"Menara BRI BSD","lat":-6.2953086,"lng":106.6654576,"alamat":"Jl. Pahlawan Seribu No.4, Lengkong Gudang, Serpong, Kota Tangerang Selatan, Banten 15310"},
	{"cabang":"KCP Pamulang","lat":-6.3430053,"lng":106.7288923,"alamat":"Ruko Pamulang Permai 1 Blok SH 20 No.3, Kec. Pamulang,, Jl. Pamulang Raya, Pamulang Bar., Pamulang, Kota Tangerang Selatan, Banten 15417"},
  {"cabang":"JKT KRAMAT","lat":-6.1877468,"lng":106.8388573,"alamat":"Jl. Kramat Raya No.138, RT.2/RW.9, Kenari, Senen, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10430"},
  {"cabang":"JKT VETERAN","lat":-6.1684996,"lng":106.8251147,"alamat":"Jalan Veteran No.8, RT.5/RW.2, Gambir, RT.5/RW.2, Gambir, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10110"},
  {"cabang":"JKT KREKOT","lat":-6.1614856,"lng":106.829902,"alamat":"Jl. Samanhudi No.127, RT.5/RW.8, Ps. Baru, Sawah Besar, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10710"},
  {"cabang":"JKT SUDIRMAN 1","lat":-6.2181081,"lng":106.8117526,"alamat":"Menara taspen, Jl. Jend. Sudirman No.kav 2, RT.14/RW.1, Bend. Hilir, Tanah Abang, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10210"},
  {"cabang":"JKT GN. SAHARI","lat":-6.1454316,"lng":106.8323111,"alamat":"Jl. Gn. Sahari No.18, RT.3/RW.1, Gn. Sahari Utara, Sawah Besar, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10720"}
];

function setMarkers(map){
  var infow = new google.maps.InfoWindow({
    maxWidth:200
  });

  for(var i=0; i < cabangBRI.length; i++){
    var bri = cabangBRI[i];
    var marker = new google.maps.Marker({
      position:{lat:bri.lat,lng:bri.lng},
      map:map,
      icon:markerBRI,
      title:bri.cabang
      //zIndex:bri[3]
    });

    allCabang.push(marker);

    google.maps.event.addListener(marker,'click',(function(marker,i){
    	var isi = '<p class=font-weight-bold>'+cabangBRI[i].cabang+'</p><address>'+cabangBRI[i].alamat+'</address>';
      return function(){
        infow.setContent(isi);
        infow.open(map,marker);
      }
    })(marker,i));
  }//END for loop markers
}

// Sets the map on all markers in the array.
function setMapOnAll(map){
  for(var i=0; i < allCabang.length; i++){
    allCabang[i].setMap(map);
  }
}

// Search Cabang Terdekat Dr Lokasi User
function startNearbyRs(){
  if(navigator.geolocation){
  	var showConfirmLokasi = setTimeout(function(){
    	$('<div class="modal-backdrop dropConfirm show" id="dropConfirmLocation"><h3>Please, Allow Your Location to use this feature</h3></div>').appendTo("body");
  	},150);

    var ww = $(window).width();
    // console.log(ww);
    if(ww <= 767){
    	detectBrowser();
    }	
		
    function geoSukses(posisi){
    	$("#dropConfirmLocation").remove();
    	clearTimeout(showConfirmLokasi);
    	setMapOnAll(null);			
			
      var pos = {
        lat:posisi.coords.latitude,
        lng:posisi.coords.longitude
      };
     	userMark = new google.maps.Marker({
        position:new google.maps.LatLng(pos.lat,pos.lng),
        map:map,
        id:'user',
		    flat:!0,
		    icon:{
          path:google.maps.SymbolPath.CIRCLE,
          fillColor:"#4285F4", // "#808080"
          fillOpacity:1,
          scale:7,
          strokeColor:"white",
          strokeWeight:2
		    },
		    optimized:false,
		    zIndex:3,
        title:'Me',
        animation:google.maps.Animation.DROP
      });

      $("#dropConfirmLocation").remove();

// TRY CUSTOM marker
			const markerlayer = new google.maps.OverlayView();
			markerlayer.draw = function(){
			  this.getPanes().markerLayer.classList.add('mark-layer');
			};
			markerlayer.setMap(map);

     	map.setZoom(12);
      map.setCenter(pos);

      for(var i=0; i < cabangBRI.length; i++){
      	var getpos = new google.maps.LatLng(pos.lat,pos.lng), // User Position
      			getBRI = new google.maps.LatLng(cabangBRI[i].lat,cabangBRI[i].lng);
      	if(getDistanceInMeter(getpos,getBRI) < 10000){
          marker = new google.maps.Marker({
            position:new google.maps.LatLng(cabangBRI[i].lat,cabangBRI[i].lng),
            map:map,
            id:cabangBRI[i],
            icon:markerBRI,
            title:cabangBRI[i].cabang,
            animation:google.maps.Animation.DROP
          });

				  var infow = new google.maps.InfoWindow({
				    maxWidth:200
				  });

			    google.maps.event.addListener(marker,'click',(function(marker,i){
			    	var isi = '<p class="font-weight-bold">'+cabangBRI[i].cabang+'</p><address>'+cabangBRI[i].alamat+'</address>';
			      return function(){
			        infow.setContent(isi);
			        infow.open(map,marker);
			      }
			    })(marker,i));
      	}
      	//else{
      		//swal("Maaf","Tidak ada cabang BRI terdekat dari lokasi Anda.");
      		//$("#dropConfirmLocation").remove();
      	//}//END if getDistanceInMeter

      }//END for loop
    }//END geoSukses()

    function geoError(err){
    	swal(errorCode[err.code],err.message);
    	$("#dropConfirmLocation").remove();
			// console.log("errorCode[err.code]: "+errorCode[err.code]+", err.message: "+err.message);
    }//END geoError()

	  var errorCode = { 
	  	0:"unknown error",
	    1:"Permission denied",
	    2:"Position unavailable",
	    3:"Request timeout"
	  };

		var geoOptions = {
		  enableHighAccuracy:true 
		  // maximumAge:30000,
		  // timeout:27000 // 10 * 1000
		};

    navigator.geolocation.getCurrentPosition(geoSukses,geoError,geoOptions);
  }
  else{
  	swal("Info","Your Device Not Support Geolocation Services");
  } //END if navigator geolocations
}//END startNearbyRs

// Distance in meter
function getDistanceInMeter(point_a,point_b){
  var distance_in_meters = google.maps.geometry.spherical.computeDistanceBetween(point_a,point_b);
  return distance_in_meters; //* 0.000621371; // convert meters to miles
}
	
function detectBrowser(){
  var userAgent = navigator.userAgent.toLowerCase();
  if(/edge/i.test(userAgent)){
    return "edge"; // edge
  }else if(/rv:11/i.test(userAgent)){
    return "ie11"; // ie11
  }else if(/msie 10/i.test(userAgent)){
    return "ie10"; // ie10
  }else if(/opr/i.test(userAgent)){
    return "opera"; // opera
  }else if(/chrome/i.test(userAgent)){
    //return "chrome"; // chrome
    $("#dropConfirmLocation").css("justify-content","flex-end");
		$("#dropConfirmLocation *").css("margin-top","0");
  }else if(/firefox/i.test(userAgent)){
    return "firefox"; // firefox
  }else if(!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)){
    return "safari"; // safari
  }
  return undefined;
}

$(function(){

	$("#btnGetDirectionAlert").click(function(){
		// swal("Info","Silahkan Klik Icon Marker Pada Peta");
		 startNearbyRs();
	});


});//END Doc Ready
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWDFqEFSh7ZpkyQ8lSHC2FO3PugkPFA7g&region=ID&libraries=geometry,places,drawing&callback=initMap"></script>

</body></html>
