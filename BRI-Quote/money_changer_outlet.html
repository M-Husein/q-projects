<!DOCTYPE html>
<html lang="en">
<head>
<base href="https://m-husein.github.io/q-projects/">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1,  maximum-scale=1, user-scalable=no, shrink-to-fit=no">
<meta name="description" content="BRI Quote Demo Web Application Develop By Muhamad Husein aka Q-think">
<meta name="author" content="Muhamad Husein, Q-think">
<meta name="theme-color" content="#254689">
<link rel="icon" href="BRI-Quote/favicon.ico">
<title>Money Changer Outlet</title>
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/fa.css">
<link rel="stylesheet" href="css/animate.css">
<link rel="stylesheet" href="BRI-Quote/bri-quote.css">
<link rel="stylesheet" href="css/Q.css">
<style>
.vmin35{
	font-size:80%;	
}
@media(max-width:767px){
	div.container.map-wrap{ /* .map-wrap */
		max-width:none;
	}
	.map-wrap .col-lg-9{
		height:75vh;
	}
	.map-wrap .card-body{
		display:-ms-flexbox;
		display:-webkit-flex;
		display:flex;
		flex-flow:row;
		align-items:center;
		justify-content:center;
		padding:.5rem;
	}
	.map-wrap .card-body > .btn{
		margin:0!important;
	}
	.map-wrap .card-body > div{
		margin:0 .5rem;
	}
	#dropConfirmLocation{
		justify-content:flex-start;
	}
	#dropConfirmLocation *{
		margin-top:18vh;
	}
	.vmin35{
		font-size:3.5vmin;	
	}
}
.mark-layer > div:nth-of-type(2){
   background-color:blue;
   overflow:initial;
   border-radius:50%;
   -webkit-tap-highlight-color:transparent;
}
.mark-layer > div:nth-of-type(2):before{
    content:'';
    display:block;
    position:absolute;
    width:100%;
    height:100%;
    top:0;
    left:0;
    background-color:inherit;
    border-radius:inherit;
    -webkit-transition:opacity .3s,-webkit-transform .3s;
    transition:opacity .3s,-webkit-transform .3s;
    transition:opacity .3s,transform .3s;
    transition:opacity .3s,transform .3s,-webkit-transform .3s;
    -webkit-animation:pulse-animation .85s cubic-bezier(0.24,0,0.38,1) infinite;
    animation:pulse-animation .85s cubic-bezier(0.24,0,0.38,1) infinite;
    z-index:-1;
}
</style>
</head>
<body class="flx-body">
<div class="modal fade" id="modalConvertRate" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Converter Rate</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" title="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <div class="form-group form-row">
          <div class="col-sm-3">
            <select class="custom-select" id="selectFromCur">
              <option value="USD" selected>USD</option>
              <option value="AUD">AUD</option>
              <option value="CHF">CHF</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
          <div class="col-sm-9">
            <input type="number" class="form-control" id="fromCur">
          </div>
        </div>
        <div class="form-group text-center">
          <span class="border border-dark rounded-circle p-2 bold">TO</span>
        </div>
        <div class="form-row">
          <div class="col-sm-3">
            <select class="custom-select">
              <!-- <option value="USD">USD</option> -->
              <option value="IDR" selected>IDR</option>
            </select>
          </div>
          <div class="col-sm-9">
            <input type="text" class="form-control bg-white" id="toCur" readonly>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" title="Close">Close</button>
        <button type="reset" class="btn btn-secondary" onclick="$('#fromCur').focus();">Reset</button>
        <button type="button" class="btn btn-warning" id="btnCalculateRate">Calculate</button>
      </div>
    </form>
  </div>
</div><!-- /#modalConvertRate -->

<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-bri" id="navMain">
  <div class="container">
    <a href="BRI-Quote/index.html"><!--  class="navbar-brand" -->
      <img src="img/BRI_Quote_Logo.png" width="100" height="40" class="d-inline-block align-top" alt="BRI Quote">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navTop" aria-controls="navTop" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navTop">
      <ul class="navbar-nav">
        <li class="nav-item"><!-- active -->
          <a class="nav-link px-3" href="BRI-Quote/home.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link px-3" href="#">Help</a>
        </li>
        <li class="nav-item">
          <a class="nav-link px-3" href="BRI-Quote/index.html">Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<nav class="navbar navbar-expand-lg navbar-light bg-custom" id="navMore">
  <div class="container">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav2" aria-controls="nav2" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-start" id="nav2">
      <div class="navbar-nav">
        <span class="nav-item dropdown mr-sm-4 here">
          <span class="btn btn-link text-dark dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Information
          </span>
          <div class="dropdown-menu">
            <a class="dropdown-item" href="BRI-Quote/counter_rate.html">Counter Rate</a>
            <a class="dropdown-item active" href="BRI-Quote/money_changer_outlet.html">Money Changer Outlet</a>
          </div>
        </span>
        <a class="nav-item nav-link text-dark mr-sm-4" href="BRI-Quote/quotation_services.html">Quotation Services</a>
        <a class="nav-item nav-link text-dark mr-sm-4" href="#modalConvertRate" data-toggle="modal">Converter rate</a>
      </div>
    </div>
  </div>
</nav>

<div class="container py-4 center-mid map-wrap">
	<div class="row w-100 flex-xs-column">
		<div class="col-lg-9 flex-1-xs"><!--  h-100 -->
			<div id="Gmap"></div>
		</div>
		<div class="col-lg-3">
			<div class="card rounded-0 text-center">
				<div class="card-body">
					<button type="button" class="btn btn-primary btn-block mb-3"><i class="fa fa-phone"></i> Call Now</button>
					<div><span class="border border-dark rounded-circle p-2">OR</span></div>
					<button type="button" class="btn btn-primary btn-block mt-3" id="btnGetDirectionAlert"><i class="fa fa-map-marker"></i> Nearest Branch</button>
				</div>
			</div>
		</div>
	</div>
</div>

<nav class="nav bg-bri">
	<div class="container d-flex flex-xs-column align-items-center justify-content-between py-2">
		<div>
			<a class="text-white vmin35" href="BRI-Quote/terms_and_conditions.html">Terms and Conditions</a>
			<span class="text-white vmin35 px-1">|</span>
			<a class="text-white vmin35" href="#">Privacy and Security Policy</a>
		</div>
		<div class="text-white vmin35">
			Copyright @ 2018 Bank Rakyat Indonesia (Persero) Tbk.
		</div>
	</div>
</nav>

<script src="js/jquery-2.1.4.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="BRI-Quote/bri-quote.js"></script>
<script src="js/sweetalert.min.js"></script>
<script src="js/bootstrap-notify.js"></script>
<script src="js/Q.js"></script>
<script>
var map,allCabang = [],userMark = [];
var markerBRI = {
  url:ORIGIN+'img/bank_bri.png'
};

function initMap(){
  map = new google.maps.Map(document.getElementById('Gmap'),{
    zoom:4,
    center:{lat:-2.0473207,lng:118.2315622}
  });
  setMarkers(map);
}

var cabangBRI = [
  {"cabang":"KANTOR CABANG KHUSUS","lat":-6.2143884,"lng":106.8066715,"Telp":"+62215709060","alamat":"Gedung BRI II Jl. Jend. Sudirman No. 44 - 46, Jakarta 10210"},
  {"cabang":"MAL AMBASADOR","lat":-6.2242746,"lng":106.8249817,"Telp":"+62215763350","alamat":"Mall Ambasador Lt. UG No. 36 Jl Prof Dr Satrio, Kuningan, Jak Selatan"},
	{"cabang":"JKT TNH ABANG","lat":-6.2242734,"lng":106.7921507,"Telp":"+62213454529","alamat":"Jl Tanah Abang III/4 Jakarta Pusat"},
  {"cabang":"JKT GT SUBROTO","lat":-6.2242711,"lng":106.7921506,"Telp":"+62215204431","alamat":"Jl Gatot Subroto Kav. 52 jakarta Selatan"},
  {"cabang":"BRI CORPORATE UNIVERSITY","lat":-6.3026755,"lng":106.8194954,"Telp":"+622178830368","alamat":"Jl. RM Harsono No. 2 RT.7/RW.7, Ragunan, Ps. Minggu, Jakarta Selatan"},
  {"cabang":"JKT KEB. BARU","lat":-6.2430527,"lng":106.7670347,"Telp":"+62217201053","alamat":"Jl.Hasanuddin No.62 Blok M, Jakarta"},
  {"cabang":"JKT SAHARJO","lat":-6.2390901,"lng":106.7984574,"Telp":"+62218314159","alamat":"Kompleks Ruko Royal Palace Blok B6-7, Jalan Professor Doktor Supomo No.178 A, RT.1/RW.15, Menteng Dalam, Tebet, Kota Jakarta Selatan, Daerah Khusus Ibukota Jakarta 12870"},

  {"cabang":"Menara BRI BSD","lat":-6.2953086,"lng":106.6654576,"Telp":"+62212510244","alamat":"Jl. Pahlawan Seribu No.4, Lengkong Gudang, Serpong, Kota Tangerang Selatan, Banten 15310"},
	{"cabang":"KCP Pamulang","lat":-6.3430053,"lng":106.7288923,"Telp":"+62217491181","alamat":"Ruko Pamulang Permai 1 Blok SH 20 No.3, Kec. Pamulang,, Jl. Pamulang Raya, Pamulang Bar., Pamulang, Kota Tangerang Selatan, Banten 15417"},
  {"cabang":"JKT KRAMAT","lat":-6.1877468,"lng":106.8388573,"Telp":"+62213100152","alamat":"Jl. Kramat Raya No.138, RT.2/RW.9, Kenari, Senen, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10430"},
  {"cabang":"JKT VETERAN","lat":-6.1684996,"lng":106.8251147,"Telp":"+62212311728","alamat":"Jalan Veteran No.8, RT.5/RW.2, Gambir, RT.5/RW.2, Gambir, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10110"},
  {"cabang":"JKT KREKOT","lat":-6.1614856,"lng":106.829902,"Telp":"+62212314176","alamat":"Jl. Samanhudi No.127, RT.5/RW.8, Ps. Baru, Sawah Besar, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10710"},
  {"cabang":"JKT SUDIRMAN 1","lat":-6.2181081,"lng":106.8117526,"Telp":"+622157933251","alamat":"Gedung Arthaloka, Jl Jend Sudirman Kav 7, Jakarta Pusat 10220"},
  {"cabang":"JKT GN. SAHARI","lat":-6.1454316,"lng":106.8323111,"Telp":"+62216006272","alamat":"Jl. Gn. Sahari No.18, RT.3/RW.1, Gn. Sahari Utara, Sawah Besar, Kota Jakarta Pusat, Daerah Khusus Ibukota Jakarta 10720"},
  {"cabang":"JKT RASUNA SAID","lat":-6.2382142,"lng":106.7959141,"Telp":"+622157942119","alamat":"Gd Wisma Bakrie 2, Lantai Dasar, Jl HR Rasuna Said, Kav b-2 Jak Selatan"}
];

function setMarkers(map){
  var infow = new google.maps.InfoWindow({
    maxWidth:250
  });

  for(var i=0; i < cabangBRI.length; i++){
    var bri = cabangBRI[i];
    var marker = new google.maps.Marker({
      position:{lat:bri.lat,lng:bri.lng},
      map:map,
      icon:markerBRI,
      title:bri.cabang
      //zIndex:bri[3]
    });

    allCabang.push(marker);

    google.maps.event.addListener(marker,'click',(function(marker,i){
    	var isi = '<p class="font-weight-bold">'+bri.cabang+'</p><address><p>'+bri.alamat+'</p><div class="input-group input-group-sm"><span class="input-group-addon cpoin copyTxt">Copy</span><input type="text" class="form-control bg-white toCopy" value="'+bri.Telp+'" readonly><span class="input-group-btn"><a href="tel:'+bri.Telp+'" class="btn btn-primary">Call</a></span></div></address>';
      return function(){
        infow.setContent(isi);
        infow.open(map,marker);
      }
    })(marker,i));
  }//END for loop markers
}

// Sets the map on all markers in the array.
function setMapOnAll(map){
  for(var i=0; i < allCabang.length; i++){
    allCabang[i].setMap(map);
  }
}

function setUserMark(map){
  for(var i=0; i < userMark.length; i++){
    userMark[i].setMap(map);
  }
}

// Search Cabang Terdekat Dr Lokasi User
function startNearbyRs(){
  if(navigator.geolocation){
  	var ww = $(window).width();
  	var showConfirmLokasi = setTimeout(function(){
    	$('<div class="modal-backdrop dropConfirm show" id="dropConfirmLocation"><h3>Please, Allow Your Location to use this feature</h3></div>').appendTo("body");
  	},150);

    if(ww <= 767){
    	detectBrowser();
    }

    function geoSukses(posisi){
    	$("#dropConfirmLocation").remove();
    	clearTimeout(showConfirmLokasi);
    	setMapOnAll(null);
      allCabang = [];
      setUserMark(null);
      userMark = [];

      var pos = {
        lat:posisi.coords.latitude,
        lng:posisi.coords.longitude
      };
     	var userPos = new google.maps.Marker({
        position:new google.maps.LatLng(pos.lat,pos.lng),
        map:map,
        // id:'user',
		    flat:!0,
		    icon:{
          path:google.maps.SymbolPath.CIRCLE,
          fillColor:"#4285F4", // "#808080"
          fillOpacity:1,
          scale:7,
          strokeColor:"white",
          strokeWeight:2
		    },
		    optimized:false,
		    zIndex:3,
        title:'Me',
        animation:google.maps.Animation.DROP
      });

      userMark.push(userPos);

			// TRY CUSTOM marker
			const markerlayer = new google.maps.OverlayView();
			markerlayer.draw = function(){
			  this.getPanes().markerLayer.classList.add('mark-layer');
			};
			markerlayer.setMap(map);

     	map.setZoom(12);
      map.setCenter(pos);

      for(var i=0; i < cabangBRI.length; i++){
      	var getpos = new google.maps.LatLng(pos.lat,pos.lng), // User Position
      			getBRI = new google.maps.LatLng(cabangBRI[i].lat,cabangBRI[i].lng);
      	if(getDistanceInMeter(getpos,getBRI) < 10000){
          marker = new google.maps.Marker({
            position:new google.maps.LatLng(cabangBRI[i].lat,cabangBRI[i].lng),
            map:map,
            id:cabangBRI[i],
            icon:markerBRI,
            title:cabangBRI[i].cabang,
            animation:google.maps.Animation.DROP
          });

				  var infow = new google.maps.InfoWindow({
				    maxWidth:250
				  });

			    google.maps.event.addListener(marker,'click',(function(marker,i){
			    	var isi = '<p class="font-weight-bold">'+cabangBRI[i].cabang+'</p><address><p>'+cabangBRI[i].alamat+'</p><div class="input-group input-group-sm"><span class="input-group-addon cpoin copyTxt">Copy</span><input type="text" class="form-control bg-white toCopy" value="'+cabangBRI[i].Telp+'" readonly><span class="input-group-btn"><a href="tel:'+cabangBRI[i].Telp+'" class="btn btn-primary">Call</a></span></div></address>';
			      return function(){
			        infow.setContent(isi);
			        infow.open(map,marker);
			      }
			    })(marker,i));
      	}
      	//else{
      		//swal("Maaf","Tidak ada cabang BRI terdekat dari lokasi Anda.");
      		//$("#dropConfirmLocation").remove();
      	//}//END if getDistanceInMeter

      }//END for loop
    }//END geoSukses()

    function geoError(err){
    	swal(errorCode[err.code],err.message);
    	$("#dropConfirmLocation").remove();
    	clearTimeout(showConfirmLokasi);
    	// console.log("errorCode[err.code]: "+errorCode[err.code]+", err.message: "+err.message);
    }//END geoError()

	  var errorCode = {
	  	0:"unknown error",
	    1:"Permission denied",
	    2:"Position unavailable",
	    3:"Request timeout"
	  };

		var geoOptions = {
		  enableHighAccuracy:true 
		  // maximumAge:30000,
		  // timeout:27000 // 10 * 1000
		};

    navigator.geolocation.getCurrentPosition(geoSukses,geoError,geoOptions);
  }
  else{
  	swal("Info","Your Device Not Support Geolocation Services");
  } //END if navigator geolocations
}//END startNearbyRs

// Distance in meter
function getDistanceInMeter(point_a,point_b){
  var distance_in_meters = google.maps.geometry.spherical.computeDistanceBetween(point_a,point_b);
  return distance_in_meters; //* 0.000621371; // convert meters to miles
}

function detectBrowser(){
  var userAgent = navigator.userAgent.toLowerCase();
  if(/edge/i.test(userAgent)){
    return "edge"; // edge
  }else if(/rv:11/i.test(userAgent)){
    return "ie11"; // ie11
  }else if(/msie 10/i.test(userAgent)){
    return "ie10"; // ie10
  }else if(/opr/i.test(userAgent)){
    return "opera"; // opera
  }else if(/chrome/i.test(userAgent)){
    //return "chrome"; // chrome
    $("#dropConfirmLocation").css("justify-content","flex-end");
    $("#dropConfirmLocation *").css("margin-top","0");
    console.log("chrome");

  }else if(/firefox/i.test(userAgent)){
    return "firefox"; // firefox
  }else if(!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)){
    return "safari"; // safari
  }
  return undefined;
}

$(function(){

	$("#btnGetDirectionAlert").click(function(){
		// swal("Info","Silahkan Klik Icon Marker Pada Peta");
		 startNearbyRs();
	});


});//END Doc Ready
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWDFqEFSh7ZpkyQ8lSHC2FO3PugkPFA7g&region=ID&libraries=geometry,places,drawing&callback=initMap"></script>

</body></html>
